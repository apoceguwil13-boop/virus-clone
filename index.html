<!DOCTYPE html>
<html>
<head>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/sdk@latest/dist/tonconnect-sdk.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Virus Clone</title>
    <style>body{font-family:Arial;text-align:center;background:#111;color:#0f0;} button{padding:15px;font-size:18px;margin:10px;background:#333;color:#0f0;border:1px solid #0f0;}</style>
</head>
<body>
    <h1>ðŸ¦  Virus Play Clone</h1>
    <div id="health">Ð—Ð´Ð¾Ñ€Ð¾Ð²ÑŒÐµ: 100%</div>
    <button id="tap">ðŸ‘† Ð’Ñ‹Ð¶Ð¸Ñ‚ÑŒ (+1-10 $VIRUS)</button>
    <div id="tokens">Ð¢Ð¾ÐºÐµÐ½Ñ‹ $VIRUS: 0</div>
    <button id="roulette">ðŸŽ° Ð ÑƒÐ»ÐµÑ‚ÐºÐ° (x2 Ð¸Ð»Ð¸ lose)</button>
    <button id="withdraw">ðŸ’° Ð’Ñ‹Ð²Ð¾Ð´ TON</button>

    <script>
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        Telegram.WebApp.MainButton.setText('ÐŸÑ€Ð¸Ð³Ð»Ð°ÑÐ¸Ñ‚ÑŒ Ð´Ñ€ÑƒÐ³Ð° (+100)').show().onClick(() => {
            Telegram.WebApp.openTelegramLink('https://t.me/share/url?url=' + encodeURIComponent(window.location.href));
        });

        const BACKEND_URL = 'https://virus-backend.vercel.app'; // Ð—Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð½Ð° Ð²Ð°Ñˆ backend URL
        let tokens = 0;
        let health = 100;
        const connector = new TON_CONNECT_SDK.TonConnect({
            manifestUrl: 'https://your-vercel-url.vercel.app/tonconnect-manifest.json' // Ð’Ð°Ñˆ Vercel URL
        });

        // Ð¢Ð°Ð¿ Ñ backend
        document.getElementById('tap').onclick = async () => {
            const response = await fetch(`${BACKEND_URL}/api/tap`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({initData: Telegram.WebApp.initData})
            });
            const data = await response.json();
            tokens = data.tokens;
            health = data.health;
            updateUI();
            Telegram.WebApp.HapticFeedback.impactOccurred('light');
        };

        // Ð ÑƒÐ»ÐµÑ‚ÐºÐ°
        document.getElementById('roulette').onclick = async () => {
            if (tokens < 10) return alert('ÐÑƒÐ¶Ð½Ð¾ 10 $VIRUS');
            const win = Math.random() > 0.5;
            tokens = win ? tokens * 2 : tokens - 10;
            await fetch(`${BACKEND_URL}/api/roulette`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({initData: Telegram.WebApp.initData, win})
            });
            updateUI();
            Telegram.WebApp.HapticFeedback.notificationOccurred(win ? 'success' : 'error');
        };

        // Ð’Ñ‹Ð²Ð¾Ð´ TON
        document.getElementById('withdraw').onclick = async () => {
            if (tokens < 100) return alert('ÐœÐ¸Ð½Ð¸Ð¼ÑƒÐ¼ 100 $VIRUS');
            try {
                await connector.connect();
                // TON Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ (Jetton transfer, Ð·Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð½Ð° Ð²Ð°Ñˆ contract)
                const transaction = {
                    validUntil: Math.floor(Date.now() / 1000) + 300,
                    messages: [{
                        address: 'YOUR_JETTON_WALLET', // Ð’Ð°Ñˆ TON wallet
                        amount: (tokens * 1000000000).toString(), // nanoTON
                        payload: 'Withdraw'
                    }]
                };
                await connector.sendTransaction(transaction);
                alert('Ð’Ñ‹Ð²Ð¾Ð´ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½!');
            } catch (e) { alert('ÐžÑˆÐ¸Ð±ÐºÐ°: ' + e.message); }
        };

        function updateUI() {
            document.getElementById('tokens').textContent = `Ð¢Ð¾ÐºÐµÐ½Ñ‹ $VIRUS: ${tokens}`;
            document.getElementById('health').textContent = `Ð—Ð´Ð¾Ñ€Ð¾Ð²ÑŒÐµ: ${health}% ${health < 50 ? 'ðŸ˜·' : 'ðŸ’ª'}`;
        }

        // Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð±Ð°Ð»Ð°Ð½ÑÐ°
        updateUI();
    </script>
</body>
</html>
