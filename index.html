<!DOCTYPE html>
<html>
<head>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/sdk@latest/dist/tonconnect-sdk.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ğŸ¦  Virus Clone</title>
    <style>
        body{font-family:Arial,sans-serif;text-align:center;background:linear-gradient(45deg,#111,#220;color:#0f0;padding:20px;}
        button{padding:15px;font-size:18px;margin:10px;border:2px solid #0f0;background:#222;color:#0f0;border-radius:10px;cursor:pointer;}
        button:active{background:#0f0;color:#111;}
        #status{font-size:24px;}
    </style>
</head>
<body>
    <h1>ğŸ¦  VIRUS PLAY Clone</h1>
    <div id="health">Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ: 100% ğŸ’ª</div>
    <div id="tokens">Ğ¢Ğ¾ĞºĞµĞ½Ñ‹ $VIRUS: 0</div>
    <div id="status"></div>
    
    <button id="tap">ğŸ‘† Ğ¢Ğ°Ğ¿Ğ°Ğ¹! Ğ’Ñ‹Ğ¶Ğ¸Ñ‚ÑŒ (+1-5 $VIRUS)</button>
    <button id="roulette">ğŸ° Ğ ÑƒĞ»ĞµÑ‚ĞºĞ° (10 $VIRUS â†’ x2 Ğ¸Ğ»Ğ¸ lose)</button>
    <button id="tasks">ğŸ“‹ Ğ—Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ (+50 $VIRUS)</button>
    <button id="withdraw">ğŸ’° Ğ’Ñ‹Ğ²Ğ¾Ğ´ Ğ½Ğ° TON (Ğ¼Ğ¸Ğ½. 100)</button>

    <script>
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        Telegram.WebApp.MainButton.setText('ğŸ‘¥ ĞŸÑ€Ğ¸Ğ³Ğ»Ğ°ÑĞ¸Ñ‚ÑŒ Ğ´Ñ€ÑƒĞ³Ğ° (+100)').show().onClick(() => {
            Telegram.WebApp.openTelegramLink('https://t.me/share/url?url=' + encodeURIComponent(window.location.href) + '&text=Ğ˜Ğ³Ñ€Ğ°Ğ¹ Ğ² Virus Clone!');
        });

        const BACKEND_URL = 'https://virus-backend.vercel.app'; // â† Ğ—ĞĞœĞ•ĞĞ˜Ğ¢Ğ• Ğ½Ğ° URL backend!
        let tokens = 0, health = 100, infected = false;
        
        const connector = new TON_CONNECT_SDK.TonConnect({
            manifestUrl: window.location.origin + '/tonconnect-manifest.json'
        });

        // Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
        async function loadData() {
            try {
                const res = await fetch(`${BACKEND_URL}/api/user`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({initData: Telegram.WebApp.initData})
                });
                const data = await res.json();
                tokens = data.tokens;
                health = data.health;
                infected = data.infected;
                updateUI();
            } catch(e) {}
        }

        // Ğ¢Ğ°Ğ¿
        document.getElementById('tap').onclick = async () => {
            const res = await fetch(`${BACKEND_URL}/api/tap`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({initData: Telegram.WebApp.initData})
            });
            const data = await res.json();
            tokens = data.tokens;
            health = data.health;
            infected = data.infected;
            updateUI();
            Telegram.WebApp.HapticFeedback.impactOccurred('medium');
        };

        // Ğ ÑƒĞ»ĞµÑ‚ĞºĞ°
        document.getElementById('roulette').onclick = async () => {
            if (tokens < 10) return Telegram.WebApp.showAlert('ĞÑƒĞ¶Ğ½Ğ¾ 10 $VIRUS!');
            const res = await fetch(`${BACKEND_URL}/api/roulette`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({initData: Telegram.WebApp.initData})
            });
            const data = await res.json();
            tokens = data.tokens;
            updateUI();
            Telegram.WebApp.HapticFeedback.notificationOccurred('success');
        };

        // Ğ—Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ
        document.getElementById('tasks').onclick = async () => {
            const res = await fetch(`${BACKEND_URL}/api/task`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({initData: Telegram.WebApp.initData})
            });
            const data = await res.json();
            tokens = data.tokens;
            document.getElementById('status').textContent = data.message || '';
            updateUI();
        };

        // Ğ’Ñ‹Ğ²Ğ¾Ğ´ TON
        document.getElementById('withdraw').onclick = async () => {
            if (tokens < 100) return Telegram.WebApp.showAlert('ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 100 $VIRUS!');
            try {
                await connector.connect();
                const tx = {
                    validUntil: Math.floor(Date.now() / 1000) + 300,
                    messages: [{
                        address: 'EQD...YOUR_WALLET_ADDRESS', // Ğ’Ğ°Ñˆ TON ĞºĞ¾ÑˆĞµĞ»Ñ‘Ğº
                        amount: (tokens * 1e9).toString(), // nanoTON
                        payload: 'Virus withdraw'
                    }]
                };
                await connector.sendTransaction(tx);
                Telegram.WebApp.showAlert('Ğ’Ñ‹Ğ²Ğ¾Ğ´ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½!');
            } catch(e) {
                Telegram.WebApp.showAlert('ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚Ğµ TON Wallet!');
            }
        };

        function updateUI() {
            document.getElementById('tokens').textContent = `Ğ¢Ğ¾ĞºĞµĞ½Ñ‹ $VIRUS: ${tokens}`;
            let status = health < 50 ? 'ğŸ˜·' : 'ğŸ’ª';
            if (infected) status += ' Ğ—ĞĞ ĞĞ–ĞĞ!';
            document.getElementById('health').innerHTML = `Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ: ${health}% ${status}`;
        }

        loadData(); // Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¿Ñ€Ğ¸ ÑÑ‚Ğ°Ñ€Ñ‚Ğµ
    </script>
</body>
</html>
